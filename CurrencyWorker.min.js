!function(e,o){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.IDBWrapper=o()}):"object"==typeof module&&module.exports?module.exports=o():e.CurrencyWorker=o()}(this,function(){"use strict";return function(e){var o={},r="",t="",s="object"==typeof e.commissions?e.commissions:{},i={},n=this;if("string"!=typeof e.baseIso||!/^[A-Z]{3}$/.test(e.baseIso))throw new Error("Неверно указан ISO базовой валюты");if("object"!=typeof e.course)throw new Error("Необходимо указать объект курсов валют по             отношению к указанной базовой валюте");e.course[e.baseIso]=1;for(r in e.course)/^[A-Z]{3}$/.test(r)&&e.course.hasOwnProperty(r)&&(o[e.baseIso+"/"+r]=Number(e.course[r]).toFixed(5),"number"==typeof s[r]&&s[r]>0&&(o[e.baseIso+"/"+r]=Number(e.course[r]+e.course[r]*s/100).toFixed(5)),i[r]=!0);for(var u in o)if((r=u.split("/")[1])!==e.baseIso)for(var f in o)t=f.split("/")[1],o[r+"/"+t]=Number(e.course[t]/e.course[r]).toFixed(5);this.convert=function(r,t,s){if((r=Number(r)||0)<0)throw new Error("Значение для конвертации должно быть >= 0");if("boolean"!=typeof i[t]||!0!==i[t])throw new Error("Неизвестный iso входной валюты");if(s){if("boolean"!=typeof i[s]||!0!==i[s])throw new Error("Неизвестный iso выходной валюты")}else s=e.baseIso;return{value:Number(r/o[t+"/"+s]).toFixed(5),iso:s,toString:function(){return n.format(this.value,this.iso,e.decimal,e.decpoint,e.ssep)}}},this.format=function(e,o,r,t,s){var i=Number(e).toFixed(r||2).toString().split(".");return t=t||".",s=s||" ",o=o||"",i[0]=i[0].replace(/(\d{1,3}(?=(\d{3})+(?:\.\d|\b)))/g,"$1"+s),i[0]+t+i[1]+" "+o},this.course=function(e){if("string"!=typeof o[e])throw new Error("Курс не найден");return o[e]}}});
